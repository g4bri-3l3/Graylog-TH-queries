# Filter for CommandHistory events
event_simpleName="CommandHistory"

# Split CommandHistory field by "¶" to create the Commands field
| eval(Commands=split(CommandHistory, "¶"))

# Join with events containing UserName, targeting a specific user if desired
| join([UserName="*"], aid)

# Select the relevant fields for display
| select @timestamp, ComputerName, ApplicationName, UserName, CommandCount_decimal, Commands, CommandHistory, LocalAddressIP4, aip, aid
