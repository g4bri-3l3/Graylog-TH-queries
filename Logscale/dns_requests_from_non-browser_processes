# Filter for DnsRequest events and rename the ContextProcessId field to TargetProcessId
event_simpleName="DnsRequest"
| rename(ContextProcessId, TargetProcessId)

# Perform a join on TargetProcessId with ProcessRollup2 events, excluding specific browser executables
| join([event_simpleName="ProcessRollup2" AND NOT ImageFileName IN ["iexplore.exe", "chrome.exe", "firefox.exe"]], TargetProcessId)

# Select the relevant fields for display
| select ComputerName, @timestamp, ImageFileName, DomainName, CommandLine
