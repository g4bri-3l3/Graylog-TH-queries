#Links Opened via Outlook.exe
# Filter for events related to outlook.exe in ProcessRollup2
aid="*" AND event_simpleName="ProcessRollup2" AND FileName="outlook.exe"
| dedup(aid, TargetProcessId_decimal)
| rename(FileName, Parent)
| rename(CommandLine, ParentCmd)
| fields ComputerName, aid, TargetProcessId_decimal, Parent, ParentCmd
# Join with ProcessRollup events for browser processes with HTTP links
| join([event_simpleName="ProcessRollup*" AND (FileName="chrome.exe" OR FileName="firefox.exe" OR FileName="iexplore.exe") AND CommandLine="*http*"], aid, TargetProcessId_decimal)
| rename(ParentProcessId_decimal, TargetProcessId_decimal)
| rename(MD5HashData, MD5)
| rename(FilePath, ChildPath)
| dedup(aid, TargetProcessId_decimal, MD5)
| fields aid, TargetProcessId_decimal, FileName, CommandLine
# Extract URLs from the CommandLine
| eval(url=extract_field(CommandLine, "https?://.*"))
# Display the output table
| select ComputerName, UserName, Parent, ParentCmd, FileName, url, CommandLine, aid



#Attachments Opened via Outlook.exe
# Filter ProcessRollup events with CommandLine indicating attachment opening via outlook.exe
event_simpleName="ProcessRollup*" AND CommandLine="*content.outlook*"
AND FileName IN ["*zip*", "*java*", "explorer.exe", "*rundll32*", "*powershell*", "*cscript.exe*", "*wscript.exe*"]
# Display relevant fields
| select ComputerName, FileName, CommandLine, TargetFileName, SHA256HashData

